<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRISTI - Surveillance System</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body {
      background-color: #121212;
      color: #eee;
      margin: 0;
      padding: 0;
    }
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .navbar-brand img {
      height: 40px;
    }
    .main-container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .video-preview {
      width: 100%;
      border-radius: 8px;
      background: black;
      image-rendering: pixelated;
      transition: filter 0.3s ease, transform 0.3s ease;
    }
    .control-group label {
      display: flex;
      justify-content: space-between;
      font-weight: 500;
      margin-bottom: 4px;
    }
    .stats-cards {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      flex-wrap: wrap;
    }
    .stat-card {
      flex: 1 1 0;
      background: #1e1e1e;
      border-radius: 8px;
      text-align: center;
      padding: 15px 0;
      border: 2px solid transparent;
      font-weight: 600;
    }
    .stat-card.whitelist { border-color: #00ff00; color: #00ff00; }
    .stat-card.blacklist { border-color: #ff0000; color: #ff0000; }
    .stat-card.unknown { border-color: #00ffff; color: #00ffff; }
    .stat-card .value {
      font-size: 2rem;
      margin-top: 5px;
    }
    .log-entries {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9rem;
    }
    .log-entry {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark shadow-sm px-4 py-2">
    <a class="navbar-brand" href="#">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" />
      <div>
        <div class="fs-5 fw-bold">DRISTI</div>
        <div class="fs-6 text-muted">Dual Mode Remote Interface for Surveillance & Tracking</div>
      </div>
    </a>
  </nav>

  <!-- Main Content -->
  <div class="main-container">
    <div class="row g-4">
      <!-- Video Preview -->
      <div class="col-md-6">
        <h5>Live Video Preview</h5>
        <img id="videoFeed" src="{{ url_for('video_feed') }}" class="video-preview" alt="Live Feed" onerror="this.src='{{ url_for('static', filename='fallback.jpg') }}';" />
      </div>

      <!-- Controls -->
      <div class="col-md-6">
        <h5>Controls</h5>
        <div class="mb-3">
          <label for="zoomControl">Zoom <span id="zoomValue">1x</span></label>
          <input type="range" id="zoomControl" min="1" max="3" step="0.1" value="1" class="form-range" />
        </div>
        <div class="mb-3">
          <label for="brightnessControl">Brightness <span id="brightnessValue">100%</span></label>
          <input type="range" id="brightnessControl" min="50" max="150" step="5" value="100" class="form-range" />
        </div>
        <div class="mb-3">
          <label for="contrastControl">Contrast <span id="contrastValue">100%</span></label>
          <input type="range" id="contrastControl" min="50" max="150" step="5" value="100" class="form-range" />
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="invertToggle">
          <label class="form-check-label" for="invertToggle">
            Invert Colors
          </label>
        </div>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="mt-5">
      <h5>Detection Stats</h5>
      <div class="stats-cards">
        <div class="stat-card whitelist">
          Whitelist
          <div class="value" id="whitelistCount">0</div>
        </div>
        <div class="stat-card blacklist">
          Blacklist
          <div class="value" id="blacklistCount">0</div>
        </div>
        <div class="stat-card unknown">
          Unknown
          <div class="value" id="unknownCount">0</div>
        </div>
      </div>
    </div>

    <!-- Detection Log -->
    <div class="mt-4">
      <h5>Detection Log</h5>
      <div class="log-entries" id="logEntries">
        <div class="log-entry">No entries yet...</div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    const videoFeed = document.getElementById("videoFeed");
    const zoomControl = document.getElementById("zoomControl");
    const brightnessControl = document.getElementById("brightnessControl");
    const contrastControl = document.getElementById("contrastControl");
    const invertToggle = document.getElementById("invertToggle");

    const zoomValueLabel = document.getElementById("zoomValue");
    const brightnessValueLabel = document.getElementById("brightnessValue");
    const contrastValueLabel = document.getElementById("contrastValue");

    function updateVideoStyle() {
      const zoom = zoomControl.value;
      const brightness = brightnessControl.value;
      const contrast = contrastControl.value;
      const invert = invertToggle.checked;

      videoFeed.style.transform = `scale(${zoom})`;
      videoFeed.style.filter = `brightness(${brightness}%) contrast(${contrast}%) ${invert ? "invert(1)" : ""}`;

      zoomValueLabel.textContent = `${zoom}x`;
      brightnessValueLabel.textContent = `${brightness}%`;
      contrastValueLabel.textContent = `${contrast}%`;
    }

    zoomControl.addEventListener("input", updateVideoStyle);
    brightnessControl.addEventListener("input", updateVideoStyle);
    contrastControl.addEventListener("input", updateVideoStyle);
    invertToggle.addEventListener("change", updateVideoStyle);

    updateVideoStyle();

    async function updateData() {
      try {
        const response = await fetch("/current_data");
        const data = await response.json();
        document.getElementById("whitelistCount").textContent = data.whitelist ?? 0;
        document.getElementById("blacklistCount").textContent = data.blacklist ?? 0;
        document.getElementById("unknownCount").textContent = data.unknown ?? 0;

        const logEntries = document.getElementById("logEntries");
        logEntries.innerHTML = "";
        (data.log ?? []).forEach((entry) => {
          const div = document.createElement("div");
          div.className = "log-entry";
          div.textContent = entry;
          logEntries.appendChild(div);
        });
      } catch (err) {
        console.error("Failed to fetch data:", err);
      }
    }

    setInterval(updateData, 5000);
    updateData();
  </script>
</body>
</html>
